<!-- "Pehle everything was working the profile pic wasnt showing aur ab vo kiya toh ye toggle hi nhi ho rhaa" -->
<!-- HELP -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Netflix Profiles</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body {
        background: linear-gradient(to bottom, rgba(0,0,0,0.8), rgba(20,20,20,1)),
                    url('https://assets.nflxext.com/ffe/siteui/vlv3/53ff1d43-f324-4c92-b5dc-bc6cf5c1f3a3/web_background.jpg') no-repeat center center/cover;
        color: white;
        min-height: 100vh;
    }
    .profile-card {
        text-align: center;
        cursor: pointer;
        animation: fadeZoom 0.6s ease forwards;
        position: relative;
    }
    .profile-card img {
        border-radius: 4px;
        transition: transform 0.3s ease;
        width: 150px;
        height: 150px;
        object-fit: cover;
    }
    .profile-card:hover img {
        transform: scale(1.05);
    }
    .kids-badge {
        position: absolute;
        bottom: 8px;
        right: 8px;
        background: #ff9900;
        color: #000;
        padding: 2px 6px;
        font-size: 0.7rem;
        font-weight: bold;
        border-radius: 3px;
    }
    @keyframes fadeZoom {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }
    .manage-btns {
        display: none;
    }
    .manage-mode .manage-btns {
        display: block;
    }
    .add-profile {
        border: 2px dashed gray;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: gray;
        height: 150px;
        border-radius: 4px;
    }
    iframe {
        width: 100%;
        height: 400px;
        border: none;
        margin-top: 30px;
    }
</style>
</head>
<body>

<div class="container text-center py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Who's Watching?</h1>
        <div>
            <button id="manageBtn" class="btn btn-outline-light me-2">Manage Profiles</button>
            <button id="logoutBtn" class="btn btn-danger">Logout</button>
        </div>
    </div>

    <div class="row g-4" id="profilesContainer">
        //working but not showing the pictures of the ones that are hardcoded
    </div>

    <iframe id="myListFrame" src="myList.html"></iframe>
</div>

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header">
                <h5 class="modal-title">Edit Profile</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="text" id="editProfileName" class="form-control mb-3">
                <input type="checkbox" id="editProfileKids" class="mb-3"> Kids Profile
                    <h5>Avatars</h5>
                    <div class="d-flex flex-wrap gap-3" id="avatarChoices">
                        
                        <img src="user1.png" class="avatar-option " data-img="user1.png" width="80">
                        <img src="user2.jpg" class="avatar-option " data-img="user2.jpg" width="80">
                        <img src="user3.jpg" class="avatar-option " data-img="user3.jpg" width="80">
                        <img src="user4.jpg" class="avatar-option " data-img="user4.jpg" width="80">
                        <img src="default.png" class="avatar-option " data-img="default.png" width="80">
                </div>

                    <!-- âœ… Preview block goes here -->
                <div class="text-center mt-3 border-secondary pt-3">
                    <h6>Selected Profile Picture</h6>
                    <img id="selectedAvatar" src="default.png" class="" width="100">
                </div>
                </div>
               
            </div>
            
            <div class="modal-footer">
                <button id="saveEditBtn" class="btn btn-primary">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    
    // let profiles = JSON.parse(localStorage.getItem('profiles')) || [
    //     { name: 'User 1', img: 'https://i.pinimg.com/564x/1b/a2/e6/1ba2e6d1d4874546c70c91f1024e17fb.jpg', kids: false },
    //     { name: 'Kids', img: 'https://occ-0-2990-2991.1.nflxso.net/art/7f2f3/abc123kidsicon.png', kids: true }

    // ];
    let profiles = JSON.parse(localStorage.getItem('profiles')) || [
    { 
      name: 'User 1', 
      img: 'default.jpg',  // replace with your own avatar URL
      kids: false 
    },
    { 
      name: 'Kids', 
      img: 'kids.jpg',  
      kids: true 
    },
    { 
        name: 'Test User', 
        img: 'images/user1.png',
        kids: false
    }

];

    let selectedProfileIndex = null;
    const profilesContainer = document.getElementById('profilesContainer');

    function renderProfiles() {
        profilesContainer.innerHTML = '';
        profiles.forEach((p, i) => {
            const col = document.createElement('div');
            col.className = 'col-auto';
            col.innerHTML = `
                <div class="profile-card" data-index="${i}">
                    <img src="${p.img}" alt="${p.name}">
                    ${p.kids ? '<div class="kids-badge">KIDS</div>' : ''}
                    <div>${p.name} ${p.kids ? " ðŸ‘¶" : ""}</div>
                    <div class="manage-btns mt-3">
                        <button class="btn btn-sm btn-warning edit-btn">Edit</button>
                        <button class="btn btn-sm btn-danger remove-btn">Remove</button>
                    </div>
                </div>
            `;
            console.log("After Save:", profiles);
            profilesContainer.appendChild(col);
        });

   
        // Add profile card
        const addCol = document.createElement('div');
        addCol.className = 'col-auto';
        addCol.innerHTML = `
            <div class="add-profile" id="addProfileBtn">
                <div style="font-size:2rem;">+</div>
                <small>Add Profile</small>
            </div>
        `;
        profilesContainer.appendChild(addCol);
    }

    function saveProfiles() {
        localStorage.setItem('profiles', JSON.stringify(profiles));
    }

    // Initial render
    renderProfiles();

    // Event Delegation
    profilesContainer.addEventListener('click', (e) => {
        const profileCard = e.target.closest('.profile-card');
        if (e.target.classList.contains('edit-btn')) {
            selectedProfileIndex = +profileCard.dataset.index;
            document.getElementById('editProfileName').value = profiles[selectedProfileIndex].name;
            document.getElementById('editProfileKids').checked = profiles[selectedProfileIndex].kids;
            document.getElementById('selectedAvatar').src = profiles[selectedProfileIndex].img;

            new bootstrap.Modal(document.getElementById('editProfileModal')).show();
        } else if (e.target.classList.contains('remove-btn')) {
            profiles.splice(+profileCard.dataset.index, 1);
            saveProfiles();
            renderProfiles();
        } else if (profileCard) {
            document.getElementById('myListFrame').scrollIntoView({ behavior: 'smooth' });
        } else if (e.target.id === 'addProfileBtn' || e.target.closest('#addProfileBtn')) {
            profiles.push({ name: 'New Profile', img: 'default.png', kids: false });
            saveProfiles();
            renderProfiles();
        }
    });

// Avatar selection inside modal
document.querySelectorAll('.avatar-option').forEach(img => {
    img.addEventListener('click', () => {
        document.querySelectorAll('.avatar-option').forEach(i => 
            i.classList.remove('border', 'border-3', 'border-primary')
        );
        img.classList.add('border', 'border-3', 'border-primary');
        document.getElementById('selectedAvatar').src = img.dataset.img;
    });
});


// âœ… Save changes from modal
document.getElementById('saveEditBtn').addEventListener('click', () => {
  if (selectedProfileIndex !== null) {
    profiles[selectedProfileIndex].name = document.getElementById('editProfileName').value;
    profiles[selectedProfileIndex].kids = document.getElementById('editProfileKids').checked;
    profiles[selectedProfileIndex].img = document.getElementById('selectedAvatar').src;

    saveProfiles();
    renderProfiles();

    selectedProfileIndex = null;
    console.log("before Save:", profiles);

    const modal = bootstrap.Modal.getInstance(document.getElementById('editProfileModal'));
    if (modal) modal.hide();
  }
});

// document.getElementById('saveEditBtn').addEventListener('click', () => {
//   if (selectedProfileIndex !== null) {
//     profiles[selectedProfileIndex].name = document.getElementById('editProfileName').value;
//     profiles[selectedProfileIndex].kids = document.getElementById('editProfileKids').checked;

//     // âœ… Save the avatar correctly (from selectedAvatar.src)
//     const avatar = document.getElementById('selectedAvatar').getAttribute('src');
//     profiles[selectedProfileIndex].img = avatar;

//     // Save and re-render
//     saveProfiles();
//     renderProfiles();

//     // Reset selection
//     selectedProfileIndex = null;

//     // âœ… Close modal properly
//     const modalEl = document.getElementById('editProfileModal');
//     const modal = bootstrap.Modal.getInstance(modalEl);
//     if (modal) modal.hide();
//   }
// });


      // Manage Profiles Toggle
      document.getElementById("manageBtn").addEventListener("click", function () {
        document.body.classList.toggle("manage-mode");
    });
    // document.getElementById('manageBtn').addEventListener('click', () => {
    //     document.getElementById('profilesContainer').classList.toggle('manage-mode');
    // });

    // Logout
    document.getElementById('logoutBtn').addEventListener('click', () => {
        alert('Logging out...');
    });

//     document.querySelectorAll('.avatar-option').forEach(img => {
//   img.addEventListener('click', () => {
//     // remove "selected" style from others
//     document.querySelectorAll('.avatar-option').forEach(i => i.classList.remove('border', 'border-3', 'border-primary'));
    
//     // add highlight to clicked image
//     img.classList.add('border', 'border-3', 'border-primary');
    
//     // update preview image
//     document.getElementById('selectedAvatar').src = img.dataset.img;
//   });
// });
//  // Save Edit Changes
// document.getElementById('saveProfileBtn').addEventListener('click', () => {
//   const chosenImg = document.getElementById('selectedAvatar').src;
  
//   // Example: update main profile picture on page
//   document.getElementById('profilePic').src = chosenImg;

//    profiles[selectedProfileIndex].name = document.getElementById('editProfileName').value;
//         saveProfiles();
//         renderProfiles();
       
//   // Close modal
//   var modal = bootstrap.Modal.getInstance(document.getElementById('editProfileModal'));
//   modal.hide();
// });
    

    // document.getElementById('saveEditBtn').addEventListener('click', () => {
    //     profiles[selectedProfileIndex].name = document.getElementById('editProfileName').value;
    //     saveProfiles();
    //     renderProfiles();
    //     bootstrap.Modal.getInstance(document.getElementById('editProfileModal')).hide();
    // });

  
</script>
</body>
</html>
